<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Tennessee Weather Dashboard</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  body { font-family: Arial, sans-serif; }
  #map { height: 700px; width: 100%; }
</style>
</head>
<body>
<h2>Tennessee Weather Dashboard</h2>
<p>Click a county to view current conditions and 7-day forecast.</p>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([35.5175, -86.5804], 7);

// OpenStreetMap base layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

// Radar overlay (HRRR)
L.tileLayer('https://www.meteo.psu.edu/ewall/HRRR15_CUR/{z}/{x}/{y}.png', {
  attribution: 'HRRR Radar'
}).addTo(map);

// Satellite overlay (GOES)
L.tileLayer('https://www.meteo.psu.edu/ewall/PSUGOES_US/loop30i/{z}/{x}/{y}.png', {
  attribution: 'GOES Satellite'
}).addTo(map);

// Load TN counties GeoJSON
fetch('data/geojson/tn_counties.geojson')
  .then(resp => resp.json())
  .then(geojson => {
    L.geoJSON(geojson, {
      style: {color: "#555", weight: 1, fillOpacity: 0.2},
      onEachFeature: function(feature, layer) {
        layer.on('click', function() {
          const lat = layer.getBounds().getCenter().lat;
          const lon = layer.getBounds().getCenter().lng;

          // Fetch weather using OpenWeatherMap OneCall API
          fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&units=imperial&appid=97b4fc10b44d9bdb0d5525a888e39487`)
            .then(res => res.json())
            .then(weather => {
              let popupContent = `<strong>${feature.properties.NAME} County</strong><br>`;
              popupContent += `Current: ${weather.current.temp}°F, ${weather.current.weather[0].description}<br>`;
              popupContent += '<strong>7-Day Forecast:</strong><br>';
              weather.daily.forEach(day => {
                const date = new Date(day.dt * 1000);
                popupContent += `${date.toDateString()}: ${day.temp.day}°F, ${day.weather[0].main}<br>`;
              });
              layer.bindPopup(popupContent).openPopup();
            })
            .catch(err => {
              layer.bindPopup('Weather data not available').openPopup();
              console.error(err);
            });
        });
      }
    }).addTo(map);
  })
  .catch(err => console.error('GeoJSON load error:', err));
</script>
</body>
</html>
